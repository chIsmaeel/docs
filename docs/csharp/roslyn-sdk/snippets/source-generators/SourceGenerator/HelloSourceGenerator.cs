using Microsoft.CodeAnalysis;

namespace SourceGenerator;
class HelloSourceGenerator : IIncrementalGenerator
{
    public void Initialize(IncrementalGeneratorInitializationContext context) 
    {

        var compilationIncrementalValue = context.CompilationProvider;
        context.RegisterSourceOutput(compilationIncrementalValue, static (context,compilation)=>
        {
            var mainMethod = compilation.GetEntryPoint(context.CancellationToken);
            string source = 
$$"""
// <auto-generated/>
using System;

namespace {{mainMethod.ContainingNamespace.ToDisplayString()}}
{
    public static partial class {{mainMethod.ContainingType.Name}}
    {
        static partial void HelloFrom(string name) =>
            Console.WriteLine($""Generator says: Hi from '{name}'"");
    }
}
""";
            var typeName = mainMethod.ContainingType.Name;

            // Add the source code to the compilation
            context.AddSource($"{typeName}.g.cs", source);
        });
        
    }
}

